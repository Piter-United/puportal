#= require jquery/jquery
#= require angular/angular
#= require angular-animate/angular-animate
#= require angular-cookies/angular-cookies
#= require angular-route/angular-route
#= require angular-sanitize/angular-sanitize
#= require angular-devise/lib/devise
#= require ng-file-upload/ng-file-upload-all
#= require selectize/dist/js/standalone/selectize
#= require moment/moment
#= require angular-ui-notification/src/angular-ui-notification
#= require_self
#= require_tree ./factories
#= require_tree ./filters
#= require_tree ./directives
#= require_tree ./controllers
#= require_tree ./interceptors

app = angular.module "app", [
  "ngCookies"
  "ngRoute"
  "ngAnimate"
  "ngFileUpload"
  "Devise"
  "ui-notification"
]

app.config ["$routeProvider", "$httpProvider", "AuthProvider" , "AuthInterceptProvider" , "NotificationProvider", ($routeProvider, $httpProvider, AuthProvider, AuthInterceptProvider, NotificationProvider)->
  NotificationProvider.setOptions({
    delay: 10000,
    startTop: 20,
    startRight: 10,
    verticalSpacing: 20,
    horizontalSpacing: 20,
    positionX: 'center',
    positionY: 'top',
    templateUrl: "<%= asset_path('templates/shared/notification.html') %>"
  });

  $httpProvider.interceptors.push('flashHttpInterceptor')
  AuthInterceptProvider.interceptAuth(true);

  rp = $routeProvider

  rp.when "/",
    name: "index"
    templateUrl: "<%= asset_path('templates/shared/index.html') %>"
    controller: "IndexCtrl"

  rp.when "/profile",
    name: "profile"
    templateUrl: "<%= asset_path('templates/shared/profile.html') %>"
    controller: "ProfileCtrl"

  rp.when "/events",
    name: "events"
    templateUrl: "<%= asset_path('templates/events/index.html') %>"
    controller: "EventsCtrl"

  rp.when "/events/new",
    name: "events"
    templateUrl: "<%= asset_path('templates/events/new.html') %>"
    controller: "NewEventCtrl"

  rp.when "/communities",
    name: "communities"
    templateUrl: "<%= asset_path('templates/communities/index.html') %>"
    controller: "CommunitiesCtrl"

  rp.when "/communities/new",
    name: "community"
    templateUrl: "<%= asset_path('templates/communities/new.html') %>"
    controller: "NewCommunityCtrl"

  rp.when "/communities/:id",
    name: "community"
    templateUrl: "<%= asset_path('templates/communities/show.html') %>"
    controller: "CommunityCtrl"

  rp.when "/events/:id",
    name: "event"
    templateUrl: "<%= asset_path('templates/events/show.html') %>"
    controller: "EventCtrl"

  rp.when "/sign_in",
    name: "sign_in"
    templateUrl: "<%= asset_path('templates/devise/sign_in.html') %>"
    controller: "SignInCtrl"

  rp.when "/sign_up",
    name: "sign_in"
    templateUrl: "<%= asset_path('templates/devise/sign_up.html') %>"
    controller: "SignUpCtrl"
]

app.run ($rootScope, $window, Data, Auth, Notification)->
  Auth.currentUser()

  $rootScope.$on "flash", (event, message)->
    Notification(message)
